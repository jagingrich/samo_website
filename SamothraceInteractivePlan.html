<!DOCTYPE html>
<html>
<head>
    <title>AES Interactive Site Plan</title>
    <link rel="icon" href="https://raw.githubusercontent.com/jagingrich/samo_website/main/Data/mapIcons/SamoWebsite_Icon.png"
          type="image/x-icon">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/gh/jagingrich/samo_website@latest/Data/mapCode/SamothraceInteractivePlan.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jagingrich/samo_website/Data/mapCode/SamothraceInteractivePlan_Styling.css" />

    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="sidebar"></div>
    

    <script>// initialize the map

        //setting initial map variables
        var groups = [];
        var tileLayers = [];
        var attribution;
        var jsonLayers = [];
        var jsons = [];
        var dropdownName;

        //setting description creation vars
        var url;
        var defaultWebID = '(0)Introduction';
        var webID = defaultWebID;
        var description = "";
        var dropdownDefault = [];
        var remove = [];
        var replace = [];
        var width = 'width ="400px"';
        var w = window.innerWidth;

        //pulling updated initialization vars
        updateInputs();

        //creating divs for parts of interactive plan
        divCreate('dropdown', 'map');
        divCreate('sidebar-content', 'sidebar');

        //creating map variable & layer control
        var map = L.map('map', {
            center: [40.50065, 25.53026],
            zoom: 18
        });
        var control = L.control.layers({}, null, { collapsed: false }).addTo(map);

        //creating map bounds
        var mapbounds = L.latLngBounds(L.latLng(40.49952, 25.52879), L.latLng(40.50176, 25.53177));
        map.flyToBounds(mapbounds);

        addRecenterControl();

        //setting the initial sidebar text on loading the map
        updateOutput(webID, url, { remove: remove, replace: replace });

        //listening for width change
        updateWidth();
        ['resize', 'focus'].forEach(function (e) {
            window.addEventListener(e, updateWidth);
        });

        //adjusting zoom on orientation change or screen resize
        ['deviceorientation', 'focus'].forEach(function (e) {
            window.addEventListener(e, (event) => {
                var allFeatures = getAllFeatures(null, control);
                if (allFeatures.length > 0) {
                    zoomToFeature(allFeatures, webID);
                }
            });
        });

        //adding layers to map, updating dropdown
        addLayerGroups(
            mapInput = map,
            layerControl = control,
            layers = [...tileLayers, ...jsonLayers],
            groups = generateLayerGroups({ groups: groups }),
            functionOnLoad = function () {
                divCreate(divName = dropdownName, //adding dropdown to map
                    divContainer = 'dropdown',
                    type = 'select',
                    functionOnCreate = function (newDiv) {
                        //creating dropdown
                        options = [...dropdownDefault, ...dropdownOptions(uniqueFeatures(getAllFeatures(null, control), 'fullName', 'Label'), 'WebCode', 'fullName')];
                        options.forEach((option) => newDiv.innerHTML += option);
                        //dropdown appearance/settings
                        newDiv.addEventListener('change', onSelect);
                        newDiv.title = "Select Monument Name to Zoom In";
                    });
                addLegend(); //adding legend to map
                addRefresh(); //adding refresh button
                updateWidth();
            });</script>
</body>
</html>
