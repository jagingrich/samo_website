<!DOCTYPE html>
<html>
<head>
    <title>AES Interactive Site Plan</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
            crossorigin=""></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>

    <script src="https://rawgit.com/Turbo87/leaflet-sidebar/master/src/L.Control.Sidebar.js"></script>

    <script src="https://rawgit.com/brunob/leaflet.fullscreen/master/Control.FullScreen.js"></script>
    <link rel="stylesheet" href="https://rawgit.com/brunob/leaflet.fullscreen/master/Control.FullScreen.css" />

    <script src="https://cdn.jsdelivr.net/gh/jagingrich/samo_website@main/Data/mapCode/SamothraceInteractivePlan.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jagingrich/samo_website@main/Data/mapCode/SamothraceInteractivePlan.css" />

    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <div id="overlay"></div>
    <div id="map"></div>

    <script>// initialize the map

        //setting initial map variables
        var groups = [];
        var tileLayers = [];
        var attribution;
        var jsonLayers = [];
        var jsons = [];
        var allFeatures = [];
        var dropdownName;

        //setting description creation vars
        var url;
        var defaultWebID = '(0)Introduction';
        var webID = defaultWebID;
        var description = "";
        var dropdownDefault = [];
        var remove = [];
        var replace = [];
        var width = 'width ="400px"';
        var w = window.innerWidth;

        //pulling updated initialization vars
        updateInputs();

        //creating divs for parts of interactive plan in map, overlay divs
        divCreate('dropdown', 'overlay');
        divCreate('sidebar', 'map');
        divCreate('sidebar-content', 'sidebar');

        
        //creating map variable & layer control
        var map = L.map('map', {
            center: [40.50065, 25.53026],
            zoom: 18,
            fullscreenControl: true,
            fullscreenControlOptions: {
                position: 'topleft'
            }
        });
        var control = L.control.layers({}, null, { collapsed: false }).addTo(map);
        
        //creating map bounds
        var mapbounds = L.latLngBounds(L.latLng(40.49952, 25.52879), L.latLng(40.50176, 25.53177));
        map.flyToBounds(mapbounds);

        //adding sidebar to map
        var sidebar = L.control.sidebar('sidebar', {
            position: 'right',
            closeButton: false
        });
        map.addControl(sidebar);
                
        //setting the initial sidebar text on loading the map
        updateOutput(webID, url, { remove: remove, replace: replace });
        setTimeout(function () {
            sidebar.show();
        }, 500);
        
        //listening for width change
        updateWidth();
        ['resize', 'deviceorientation', 'focus'].forEach(function (e) {
            window.addEventListener(e, updateWidth);
        });

        //adjusting zoom on orientation change or screen resize
        ['resize', 'deviceorientation', 'focus'].forEach(function (e) {
            window.addEventListener(e, (event) => {
                if (allFeatures.length > 0) {
                    zoomToFeature(allFeatures, webID);
                }
            });
        });

        //adding layers to map, updating dropdown
        addLayerGroups(
            mapInput = map,
            layerControl = control,
            layers = [...tileLayers, ...jsonLayers],
            groups = generateLayerGroups({ groups: groups }),
            functionOnLoad = function () {
                addDropdown( //adding dropdown to map
                    options = [...dropdownDefault, ...dropdownOptions(uniqueFeatures(getAllFeatures(null, control), 'fullName', 'Label'), 'WebCode', 'fullName')],
                    divName = dropdownName)
                addLegend(); //adding legend to map
                addRefresh(); //adding refresh button
            });

    </script>
</body>
</html>
